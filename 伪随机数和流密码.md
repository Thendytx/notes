1. 要点
    1. 随机数的产生， 产生的数据流必须不能预测
        1. 真随机， 则本身满足不可预测
        2. 伪随机， 则要求它不可预测
       
            PRNG， 伪随机数发生器。 是一种确定性随机数发生器(DRNG)
    2. 流密码是对称密码算法， 使用最广泛的此类密码是RC4
2. 随机数的原则
    1. 随机数的应用
    
        密钥分发和互相认证方案、 会话密钥的产生、 RSA公钥加密中密钥的产生、 对称流密码加密的位流的产生
        1. 随机性
            1. 分布均匀性
            2. 独立性
        2. 不可预测性
    2. TRNG、PRNG、PRF
        
        TRNG以熵源作为输入， 熵源是从物理环境抽取的。<br>PRNG取一个固定值作为种子， 用一个确定性算法产生位输出序列， 该算法中通常有反馈路径。 输出位流仅有输入值决定， 由算法和种子， 可以重现整个位流。<br>PRF类似PRNG， 但是不输出不限长位流， 而是产生固定长度的伪随机位串。 比如对称加密密钥或时变值。 通常PRF的输入除了种子还有一些上下文相关的特定值， 如用户ID、应用ID等。
    3. PRNG的基本要求
        
        不知道种子时不能决定伪随机串。
        1. 随机性

            没有单个测试能够判断PRNG的随机性， 但可以判断一些PRNG不满足随机性。
            1. 对于PRNG的测试应建立如下三个特征：(NIST SP800-22)
                1. 均匀性
                    
                    在任何点， 0和1的概率相等。 或在任意段， 0和1数量大致相当
                2. 可伸缩性

                    任何子序列都应通过随机性测试
                3. 一致性

                    对于所有种子， 发生器的行为应当一致。 基于单个种子测试PRNG或基于单个物理源测试TRNG都不充分。
            2. SP800-22列出了15种单独的随机性测试。 下面是其中的三个测试及其目的
                1. 频率测试

                    最基本的测试， 任何测试工具集都应包含。 测试的目的是判断序列中0和1的个数是否和真随机序列的期望值大致相同
                2. 游程测试

                    游程指相同位构成的不间断序列， 其前后的位取与游程位不同的值。 目的是判断各种长度的01游程的数量是否符合随机序列的期望值。
                3. Maurer通用统计测试

                    匹配模式间的位数。 匹配模式是与压缩序列长度相关的一种度量。 测试的目的是检测序列是否能大幅度压缩而不损失信息； 能大幅度压缩的序列被认为是非随机的。
        2. 不可预测性

            1. 前向不可预测性

                如果不知道种子， 那么不管知道前面的多少位， 都无法预测序列中的下一位
            2. 后向不可预测性

                从产生的任何值都不能推断种子值
            3. 随机性测试集也提供了不可预测性测试
        3. 种子的要求

            种子本身必须是随机数或伪随机数<br>
            SP800-90推荐种子由TRNG产生。<br>
            1. 直接使用TRNG的缺点如下
                1. 对于流密码， 发送者需要将密钥流和明文一起安全地发送给接收者， 相比之下， 使用PRNG时只需要发送PRNG的种子
                2. TRNG可能产生不平衡的二元序列
                3. TRNG的生成速率可能无法满足应用的需求
    4. 算法设计
        1. 特意构造的算法

            如RC4， 特意为流密码设计的算法
        2. 基于现存密码算法的算法

            密码学算法有随机化输入的效果(消除统计特征)。以下三种密码学算法常用于产生PRNG
            1. 对称分组密码
            2. 非对称密码(chap10)
            3. Hash函数与消息认证码(chap12)
3. 伪随机数发生器
    1. 线性同余发生器

        参数： m、a、c、X0。 分别代表模、乘数、增量、种子或初始值。 其中， m > 0， 0 < a < m，0 ≤ c < m， 0 ≤ X0 < m<br>
        随机数序列{Xn}按照下面的迭代式获得：<br>
        Xn+1 = (aXn + c) mod m<br>
        acm的选择对于发生器的随机性很重要。 m一般很大， 可以产生长连串的不同随机数。 常用标准是m与给定计算机可表示的最大非负整数值接近相等， 如对于32位机， m接近或等于2^31^
        <br>
        1. 随机数发生器评价标准：
            1. 全周期。重复前应产生0-m的所有数

                对于线性同余发生器， 若m为素数且c==0， 则a的某些取值可以使生成周期为m-1，只是得不到0。 比如对于32位来说， 2^32-1就是常用素数。 a=7^5^时可以满足上述条件， 并且运用广泛， 经过了更全面的测试。
            2. 生成的序列显得随机

                m与a恰当时， 序列的特性与从1~m-1的随机无放回抽取序列相当。<br>但除了X0， 算法没有随机的东西， 一旦知道是线性同余算法， 密码分析就非常容易
            3. 生成函数可以用32位运算器方便地实现
        2. 缺点克服
            1. 修正随机数流
                1. 周期性地以时钟值模m作为新的种子
                2. 随机数加上时钟值再对m取模
    2. BBS发生器
        1. 产生过程
            1. 选定两个大素数p和q， 要求 p mod 4 == 3 && q mod 4 == 3， 即p≡q≡3(mod4)。
            2. 令n=p*q， 并选定随机数s， 要求s与n互素， 即 p q都不是s的因子， 然后BBS按照下列算法产生位Bi序列
                1. x0 = s^2^ mod n
                2. for i = 1 to ∞
                    1. xi = (xi-1)^2^ mod n
                    2. Bi = xi mod 2
        2. 能经受续位测试
            1. 给定序列开始的k位， 对第k+1位的预测概率不超过1/2。
            2. 安全性基于对n的因子分解的困难性， 即给定n， 不能确定其素因子p和q

4. 使用分组密码的伪随机产生
5. 流密码
6. RC4
    1. 初始化S
    2. 密钥流的生成
    3. RC4的强度
7. 真随机数发生器
    1. 熵源
        1. 声音/图像输入
        2. 磁盘驱动
    2. 偏差